<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Private Chat with Maryam</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
    --bg: #e9eef3;
    --card: #ffffff;
    --header: #2f80ed;
    --text: #000000;
    --subtext: #666;
    --mymsg: #d9ecff;
    --theirmsg: #ffffff;
    --border: #ddd;
}

body.dark {
    --bg: #121212;
    --card: #1e1e1e;
    --header: #1f6feb;
    --text: #ffffff;
    --subtext: #aaa;
    --mymsg: #2a4d7a;
    --theirmsg: #2a2a2a;
    --border: #333;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", Arial, sans-serif;
}

body {
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text);
}

/* CONTAINER */
.container {
    width: 100%;
    max-width: 420px;
    height: 90vh;
    background: var(--card);
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    display: none;
    overflow: hidden;
}

/* HEADER */
header {
    background: var(--header);
    color: white;
    padding: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

header h1 {
    font-size: 16px;
    font-weight: 600;
}

header button {
    background: none;
    border: none;
    color: white;
    font-size: 14px;
    cursor: pointer;
}

/* AUTH */
#auth-screen {
    padding: 30px;
}

input, button.main {
    width: 100%;
    padding: 13px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid var(--border);
    font-size: 14px;
    background: var(--card);
    color: var(--text);
}

button.main {
    background: var(--header);
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 600;
}

.switch {
    text-align: center;
    font-size: 13px;
}

.switch a {
    color: var(--header);
    text-decoration: none;
    font-weight: 600;
}

/* CHAT */
#chat-screen {
    display: flex;
    flex-direction: column;
}

#messages {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: var(--bg);
}

.message {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 12px;
    margin-bottom: 12px;
    font-size: 14px;
    position: relative;
}

.my-message {
    background: var(--mymsg);
    margin-left: auto;
}

.their-message {
    background: var(--theirmsg);
    border: 1px solid var(--border);
}

.time {
    font-size: 10px;
    color: var(--subtext);
    margin-top: 4px;
    text-align: right;
}

.delete-btn {
    position: absolute;
    top: 4px;
    right: 6px;
    font-size: 12px;
    cursor: pointer;
    color: var(--subtext);
    display: none;
}

.my-message:hover .delete-btn {
    display: block;
}

/* INPUT */
.chat-input {
    display: flex;
    gap: 10px;
    padding: 10px;
    border-top: 1px solid var(--border);
    background: var(--card);
}

.chat-input input {
    flex: 1;
}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth-screen" class="container">
    <header>
        <h1>Private Chat</h1>
        <button onclick="toggleDark()">Dark</button>
    </header>

    <input type="email" id="login-email" placeholder="Email">
    <input type="password" id="login-password" placeholder="Password">
    <button class="main" onclick="login()">Login</button>

    <div class="switch">
        New here? <a href="#" onclick="showRegister()">Create account</a>
    </div>

    <div id="register-form" style="display:none;">
        <input type="text" id="username" placeholder="Your name">
        <input type="email" id="register-email" placeholder="Email">
        <input type="password" id="register-password" placeholder="Password">
        <button class="main" onclick="register()">Register</button>
        <div class="switch">
            <a href="#" onclick="showLogin()">Back to login</a>
        </div>
    </div>
</div>

<!-- CHAT -->
<div id="chat-screen" class="container">
    <header>
        <h1>Chat with Maryam</h1>
        <button onclick="toggleDark()">Dark</button>
    </header>

    <div id="messages"></div>

    <div class="chat-input">
        <input type="text" id="message" placeholder="Type a message..." onkeypress="checkEnter(event)">
        <button class="main" onclick="sendMessage()">Send</button>
    </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser;

auth.onAuthStateChanged(user => {
    if (user) {
        currentUser = user;
        showChat();
        loadMessages();
    } else {
        showAuth();
    }
});

/* UI */
function showAuth() {
    auth-screen.style.display = "block";
    chat-screen.style.display = "none";
}

function showChat() {
    auth-screen.style.display = "none";
    chat-screen.style.display = "flex";
}

function showRegister() {
    register-form.style.display = "block";
}

function showLogin() {
    register-form.style.display = "none";
}

function toggleDark() {
    document.body.classList.toggle("dark");
}

/* AUTH */
function register() {
    auth.createUserWithEmailAndPassword(
        register-email.value,
        register-password.value
    ).then(res => {
        return db.ref("users/" + res.user.uid).set({
            name: username.value
        });
    });
}

function login() {
    auth.signInWithEmailAndPassword(
        login-email.value,
        login-password.value
    );
}

/* CHAT */
function sendMessage() {
    if (!message.value) return;

    db.ref("messages").push({
        text: message.value,
        uid: currentUser.uid,
        time: Date.now()
    });

    message.value = "";
}

function checkEnter(e) {
    if (e.key === "Enter") sendMessage();
}

function deleteMessage(id) {
    db.ref("messages/" + id).remove();
}

function loadMessages() {
    db.ref("messages").limitToLast(100).on("child_added", snap => {
        const msg = snap.val();
        const div = document.createElement("div");

        div.className = "message " + 
            (msg.uid === currentUser.uid ? "my-message" : "their-message");

        div.innerHTML = `
            ${msg.uid === currentUser.uid ? `<span class="delete-btn" onclick="deleteMessage('${snap.key}')">Delete</span>` : ""}
            <div>${msg.text}</div>
            <div class="time">
                ${new Date(msg.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}
            </div>
        `;

        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    });
}
</script>

</body>
</html>
