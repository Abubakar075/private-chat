<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChatConnect - Modern Messaging</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Theme Variables */
        :root {
            --bg-primary: #f0f4f8;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f7fafc;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --accent-primary: #3b82f6;
            --accent-secondary: #64748b;
            --message-sent: #3b82f6;
            --message-received: #e5e7eb;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .message-animation {
            animation: slideIn 0.3s ease-out;
        }
        
        .typing-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .chat-scroll {
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) var(--bg-tertiary);
        }
        
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-scroll::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        .chat-scroll::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        
        .transition-theme {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .emoji-picker-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
            max-height: 180px;
            overflow-y: auto;
        }
        
        @media (min-width: 768px) {
            .emoji-picker-grid {
                grid-template-columns: repeat(8, 1fr);
                gap: 8px;
                max-height: 200px;
            }
        }
        
        .emoji-btn {
            font-size: 20px;
            padding: 6px;
            cursor: pointer;
            border-radius: 8px;
            transition: transform 0.2s, background-color 0.2s;
        }
        
        @media (min-width: 768px) {
            .emoji-btn {
                font-size: 24px;
                padding: 8px;
            }
        }
        
        .emoji-btn:hover {
            transform: scale(1.2);
            background-color: var(--bg-tertiary);
        }
        
        .online-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }
        
        .reaction-picker {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 6px;
            box-shadow: 0 4px 12px var(--shadow);
            display: flex;
            gap: 3px;
            z-index: 10;
            margin-bottom: 8px;
        }
        
        @media (min-width: 768px) {
            .reaction-picker {
                padding: 8px;
                gap: 4px;
            }
        }
        
        .reaction-btn {
            font-size: 18px;
            padding: 4px;
            cursor: pointer;
            border-radius: 50%;
            transition: transform 0.2s, background-color 0.2s;
            border: none;
            background: transparent;
        }
        
        @media (min-width: 768px) {
            .reaction-btn {
                font-size: 20px;
                padding: 6px;
            }
        }
        
        .reaction-btn:hover {
            transform: scale(1.3);
            background-color: var(--bg-tertiary);
        }
        
        .message-reactions {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 6px;
        }
        
        .reaction-item {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 13px;
            background-color: rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            user-select: none;
        }
        
        @media (min-width: 768px) {
            .reaction-item {
                padding: 2px 8px;
                font-size: 14px;
            }
        }
        
        .reaction-item:hover {
            transform: scale(1.1);
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .reaction-item.user-reacted {
            background-color: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .message-bubble-wrapper {
            position: relative;
        }
        
        .avatar-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .avatar-circle {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto">
  <div id="app-wrapper" class="w-full h-full flex flex-col"><!-- Login Screen -->
   <div id="login-screen" class="w-full h-full flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white rounded-2xl shadow-2xl p-8">
     <div class="text-center mb-8">
      <div class="text-5xl mb-4">
       üí¨
      </div>
      <h1 class="text-3xl font-bold mb-2">ChatConnect</h1>
      <p class="text-gray-600">Connect with friends instantly</p>
     </div>
     <form id="login-form" class="space-y-4">
      <div><label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label> <input type="text" id="username" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all" placeholder="Enter your username">
      </div><button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold transition-all transform hover:scale-105" id="login-button"> Start Chatting </button>
     </form>
     <div class="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
      <p class="text-xs text-green-800 font-semibold mb-2">‚úÖ Firebase Connected!</p>
      <p class="text-xs text-gray-600">Real-time messaging is active. All features are working:</p>
      <ul class="text-xs text-gray-600 ml-4 mt-2 list-disc space-y-1">
       <li>Live message sync</li>
       <li>Typing indicators</li>
       <li>Online status</li>
       <li>Message reactions</li>
       <li>Read receipts</li>
      </ul>
     </div>
    </div>
   </div><!-- Main Chat Interface -->
   <div id="chat-screen" class="hidden w-full h-full flex flex-col"><!-- Header -->
    <header class="flex-shrink-0 px-4 md:px-6 py-3 md:py-4 border-b transition-theme flex items-center justify-between bg-white" id="chat-header">
     <div class="flex items-center space-x-2 md:space-x-3">
      <div class="text-2xl md:text-3xl">
       üí¨
      </div>
      <div>
       <h1 class="text-lg md:text-xl font-bold transition-theme">ChatConnect</h1>
       <div class="flex items-center space-x-1"><span class="online-indicator"></span>
        <p class="text-xs transition-theme">Online</p>
       </div>
      </div>
     </div>
     <div class="flex items-center space-x-1 md:space-x-2"><button id="logout-button" class="px-3 md:px-4 py-2 text-xs md:text-sm font-medium bg-gray-600 text-white rounded-lg transition-all hover:scale-105"> Logout </button>
     </div>
    </header><!-- Messages Area -->
    <div class="flex-1 overflow-hidden flex"><!-- Chat Area -->
     <main class="flex-1 flex flex-col bg-gray-50"><!-- Messages -->
      <div id="messages-container" class="flex-1 overflow-auto chat-scroll p-3 md:p-6 space-y-3 md:space-y-4">
       <div class="text-center text-gray-500 text-sm py-4">
        <p>üëã Welcome! Send a message to get started.</p>
       </div>
      </div><!-- Message Input -->
      <div class="flex-shrink-0 p-2 md:p-4 border-t transition-theme bg-white"><!-- Emoji Picker -->
       <div id="emoji-picker" class="hidden mb-3 p-3 border rounded-lg transition-theme bg-white">
        <div class="emoji-picker-grid" id="emoji-grid"></div>
       </div><!-- Reply Banner -->
       <div id="reply-banner" class="hidden mb-2 p-3 border-l-4 border-blue-500 bg-blue-50 rounded flex items-start justify-between">
        <div class="flex-1 min-w-0">
         <p class="text-xs font-semibold text-blue-600 mb-1">Replying to <span id="reply-to-name"></span></p>
         <p class="text-sm text-gray-600 truncate" id="reply-to-text"></p>
        </div><button id="cancel-reply" class="ml-2 text-gray-500 hover:text-gray-700 text-xl">√ó</button>
       </div><!-- Typing Indicator -->
       <div id="typing-indicator" class="hidden mb-2 text-xs md:text-sm transition-theme typing-indicator"><span id="typing-user">Someone</span> is typing...
       </div>
       <form id="message-form" class="flex space-x-1 md:space-x-2"><button type="button" id="emoji-toggle" class="px-2 md:px-3 py-2 md:py-3 bg-gray-200 rounded-full font-semibold transition-all transform hover:scale-110 text-xl md:text-2xl" title="Add Emoji"> üòä </button> <input type="text" id="message-input" placeholder="Type a message..." class="flex-1 px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-theme"> <button type="submit" class="px-3 md:px-6 py-2 md:py-3 bg-blue-500 text-white rounded-full font-semibold transition-all transform hover:scale-105 text-sm md:text-base" id="send-button"> <span class="hidden md:inline">Send üì§</span> <span class="md:hidden">üì§</span> </button>
       </form>
      </div>
     </main>
    </div>
   </div>
  </div><!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
        // ========================================
        // üî• FIREBASE CONFIGURATION
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyC3z-0TFNvgAwGIxis--XAzPXjP30DeCe8",
            authDomain: "maryum-f169b.firebaseapp.com",
            databaseURL: "https://maryum-f169b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "maryum-f169b",
            storageBucket: "maryum-f169b.firebasestorage.app",
            messagingSenderId: "120896430100",
            appId: "1:120896430100:web:d0a0a78220b34d59f2c701"
        };
        
        // Initialize Firebase
        let database = null;
        
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log("‚úÖ Firebase connected successfully!");
        } catch (error) {
            console.error("‚ùå Firebase initialization failed:", error.message);
        }
        
        // ========================================
        // STATE MANAGEMENT
        // ========================================
        let currentUser = null;
        let currentUserId = null;
        let replyingTo = null;
        let typingTimeout = null;
        let messagesRef = null;
        let typingRef = null;
        let onlineRef = null;
        
        // Quick reaction emojis
        const quickReactions = ['‚ù§Ô∏è', 'üëç', 'üòÇ', 'üòÆ', 'üò¢', 'üôè'];
        
        // Emoji list
        const emojis = ['üòÄ','üòÉ','üòÑ','üòÅ','üòÜ','üòÖ','ü§£','üòÇ','üôÇ','üôÉ','üòâ','üòä','üòá','ü•∞','üòç','ü§©','üòò','üòó','‚ò∫Ô∏è','üòö','üòô','ü•≤','üòã','üòõ','üòú','ü§™','üòù','ü§ë','ü§ó','ü§≠','ü§´','ü§î','ü§ê','ü§®','üòê','üòë','üò∂','üòè','üòí','üôÑ','üò¨','ü§•','üòå','üòî','üò™','ü§§','üò¥','üò∑','ü§í','ü§ï','ü§¢','ü§Æ','ü§ß','ü•µ','ü•∂','üòµ','ü§Ø','ü§†','ü•≥','üòé','ü§ì','üßê','üòï','üòü','üôÅ','‚òπÔ∏è','üòÆ','üòØ','üò≤','üò≥','ü•∫','üò¶','üòß','üò®','üò∞','üò•','üò¢','üò≠','üò±','üòñ','üò£','üòû','üòì','üò©','üò´','ü•±','üò§','üò°','üò†','ü§¨','üëç','üëé','üëã','ü§ö','‚úã','üññ','üëå','ü§å','ü§è','‚úåÔ∏è','ü§û','ü§ü','ü§ò','ü§ô','üëà','üëâ','üëÜ','üñï','üëá','‚òùÔ∏è','üëè','üôå','üëê','ü§≤','ü§ù','üôè','‚úçÔ∏è','üíÖ','ü§≥','üí™','‚ù§Ô∏è','üß°','üíõ','üíö','üíô','üíú','üñ§','ü§ç','ü§é','üíî','‚ù§Ô∏è‚Äçüî•','‚ù§Ô∏è‚Äçü©π','üíï','üíû','üíì','üíó','üíñ','üíò','üíù','‚≠ê','üåü','‚ú®','üî•','üí´','üéâ','üéä','üéà','üéÅ','üèÜ','ü•á','ü•à','ü•â'];
        
        // DOM elements
        const loginScreen = document.getElementById('login-screen');
        const chatScreen = document.getElementById('chat-screen');
        const loginForm = document.getElementById('login-form');
        const messageForm = document.getElementById('message-form');
        const messageInput = document.getElementById('message-input');
        const messagesContainer = document.getElementById('messages-container');
        const emojiGrid = document.getElementById('emoji-grid');
        const typingIndicator = document.getElementById('typing-indicator');
        
        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function generateAvatar(name) {
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
            ];
            const initial = name ? name.charAt(0).toUpperCase() : '?';
            const colorIndex = name ? name.charCodeAt(0) % colors.length : 0;
            return { initial, background: colors[colorIndex] };
        }
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // ========================================
        // AUTHENTICATION
        // ========================================
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            
            if (username && database) {
                currentUser = username;
                currentUserId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Set user online
                onlineRef = database.ref('online/' + currentUserId);
                onlineRef.set({
                    username: currentUser,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                
                // Remove online status on disconnect
                onlineRef.onDisconnect().remove();
                
                showChatScreen();
            }
        });
        
        function showChatScreen() {
            loginScreen.classList.add('hidden');
            chatScreen.classList.remove('hidden');
            
            // Initialize Firebase listeners
            initializeFirebaseListeners();
            
            // Clear welcome message
            messagesContainer.innerHTML = '';
        }
        
        document.getElementById('logout-button').addEventListener('click', () => {
            if (onlineRef) {
                onlineRef.remove();
            }
            
            currentUser = null;
            currentUserId = null;
            messagesContainer.innerHTML = '<div class="text-center text-gray-500 text-sm py-4"><p>üëã Welcome! Send a message to get started.</p></div>';
            chatScreen.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            document.getElementById('username').value = '';
        });
        
        // ========================================
        // FIREBASE LISTENERS
        // ========================================
        function initializeFirebaseListeners() {
            // Listen for new messages
            messagesRef = database.ref('messages');
            messagesRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message, snapshot.key);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            });
            
            // Listen for message reactions
            messagesRef.on('child_changed', (snapshot) => {
                const message = snapshot.val();
                updateMessageReactions(snapshot.key, message.reactions || {});
            });
            
            // Listen for typing indicators
            typingRef = database.ref('typing');
            typingRef.on('value', (snapshot) => {
                const typingUsers = snapshot.val();
                if (typingUsers) {
                    const otherUsers = Object.values(typingUsers).filter(u => u.userId !== currentUserId);
                    if (otherUsers.length > 0) {
                        document.getElementById('typing-user').textContent = otherUsers[0].username;
                        typingIndicator.classList.remove('hidden');
                    } else {
                        typingIndicator.classList.add('hidden');
                    }
                } else {
                    typingIndicator.classList.add('hidden');
                }
            });
        }
        
        // ========================================
        // MESSAGING
        // ========================================
        messageForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = messageInput.value.trim();
            
            if (!text || !database) return;
            
            const messageData = {
                text: text,
                senderId: currentUserId,
                senderName: currentUser,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                replyTo: replyingTo || null,
                reactions: {}
            };
            
            try {
                await messagesRef.push(messageData);
                messageInput.value = '';
                
                if (replyingTo) {
                    cancelReply();
                }
                
                // Stop typing indicator
                database.ref('typing/' + currentUserId).remove();
            } catch (error) {
                console.error('Error sending message:', error);
            }
        });
        
        function displayMessage(msg, msgId) {
            const isOwn = msg.senderId === currentUserId;
            const avatar = generateAvatar(msg.senderName);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-animation flex gap-2 ${isOwn ? 'justify-end' : 'justify-start'}`;
            messageDiv.dataset.messageId = msgId;
            
            let avatarHTML = '';
            if (!isOwn) {
                avatarHTML = `<div class="avatar-circle" style="background: ${avatar.background}; color: white;">${avatar.initial}</div>`;
            }
            
            messageDiv.innerHTML = `
                ${avatarHTML}
                <div class="message-bubble-wrapper relative flex-1 max-w-[85%] md:max-w-md">
                    <div class="message-bubble rounded-2xl ${isOwn ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'} px-4 py-3 cursor-pointer hover:shadow-lg transition-all">
                        ${msg.replyTo ? `
                            <div class="mb-2 p-2 rounded ${isOwn ? 'bg-blue-600 bg-opacity-50' : 'bg-gray-300'} border-l-2 ${isOwn ? 'border-white' : 'border-gray-500'}">
                                <p class="text-xs ${isOwn ? 'text-blue-100' : 'text-gray-600'} font-semibold mb-1">‚Ü©Ô∏è ${msg.replyTo.senderName}</p>
                                <p class="text-xs ${isOwn ? 'text-blue-50' : 'text-gray-600'} truncate">${msg.replyTo.text}</p>
                            </div>
                        ` : ''}
                        ${!isOwn ? `<p class="text-xs ${isOwn ? 'text-blue-100' : 'text-gray-600'} font-semibold mb-1">${msg.senderName}</p>` : ''}
                        <p class="text-sm break-words">${msg.text}</p>
                        <p class="text-xs ${isOwn ? 'text-blue-100' : 'text-gray-500'} mt-1">${msg.timestamp ? formatTime(msg.timestamp) : 'Now'}</p>
                        <div class="message-reactions"></div>
                    </div>
                    <div class="flex gap-1 mt-1 text-xs">
                        <button class="message-action p-1 hover:bg-gray-200 rounded" onclick="replyToMessage('${msgId}', '${msg.senderName}', '${msg.text.replace(/'/g, "\\'")}', event)" title="Reply">üí¨</button>
                        <button class="message-action p-1 hover:bg-gray-200 rounded" onclick="showReactionPicker('${msgId}', event)" title="React">‚ù§Ô∏è</button>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            updateMessageReactions(msgId, msg.reactions || {});
        }
        
        // ========================================
        // MESSAGE ACTIONS
        // ========================================
        window.replyToMessage = function(msgId, senderName, text, event) {
            event.stopPropagation();
            replyingTo = { id: msgId, senderName, text };
            document.getElementById('reply-banner').classList.remove('hidden');
            document.getElementById('reply-to-name').textContent = senderName;
            document.getElementById('reply-to-text').textContent = text;
            messageInput.focus();
        };
        
        function cancelReply() {
            replyingTo = null;
            document.getElementById('reply-banner').classList.add('hidden');
        }
        
        document.getElementById('cancel-reply').addEventListener('click', cancelReply);
        
        window.showReactionPicker = function(msgId, event) {
            event.stopPropagation();
            const msgDiv = document.querySelector(`[data-message-id="${msgId}"]`);
            const bubble = msgDiv.querySelector('.message-bubble');
            
            const existingPicker = document.querySelector('.reaction-picker');
            if (existingPicker) existingPicker.remove();
            
            const picker = document.createElement('div');
            picker.className = 'reaction-picker';
            
            quickReactions.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'reaction-btn';
                btn.textContent = emoji;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    addReaction(msgId, emoji);
                    picker.remove();
                };
                picker.appendChild(btn);
            });
            
            msgDiv.querySelector('.message-bubble-wrapper').appendChild(picker);
            
            setTimeout(() => {
                document.addEventListener('click', function closePicker(e) {
                    if (!picker.contains(e.target)) {
                        picker.remove();
                        document.removeEventListener('click', closePicker);
                    }
                });
            }, 10);
        };
        
        async function addReaction(msgId, emoji) {
            if (!currentUserId || !database) return;
            
            const messageRef = database.ref('messages/' + msgId);
            const snapshot = await messageRef.once('value');
            const message = snapshot.val();
            
            if (!message) return;
            
            let reactions = message.reactions || {};
            
            if (!reactions[emoji]) {
                reactions[emoji] = [];
            }
            
            const userIndex = reactions[emoji].indexOf(currentUserId);
            if (userIndex > -1) {
                reactions[emoji].splice(userIndex, 1);
                if (reactions[emoji].length === 0) {
                    delete reactions[emoji];
                }
            } else {
                reactions[emoji].push(currentUserId);
            }
            
            await messageRef.update({ reactions });
        }
        
        function updateMessageReactions(msgId, reactions) {
            const msgDiv = document.querySelector(`[data-message-id="${msgId}"]`);
            if (!msgDiv) return;
            
            const container = msgDiv.querySelector('.message-reactions');
            container.innerHTML = '';
            
            Object.entries(reactions).forEach(([emoji, users]) => {
                if (users.length > 0) {
                    const item = document.createElement('div');
                    item.className = `reaction-item ${users.includes(currentUserId) ? 'user-reacted' : ''}`;
                    item.innerHTML = `${emoji}<span class="reaction-count">${users.length}</span>`;
                    item.onclick = () => addReaction(msgId, emoji);
                    container.appendChild(item);
                }
            });
        }
        
        // ========================================
        // EMOJI PICKER
        // ========================================
        function initEmojiPicker() {
            emojis.forEach(emoji => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'emoji-btn';
                btn.textContent = emoji;
                btn.addEventListener('click', () => {
                    messageInput.value += emoji;
                    messageInput.focus();
                    document.getElementById('emoji-picker').classList.add('hidden');
                });
                emojiGrid.appendChild(btn);
            });
        }
        
        document.getElementById('emoji-toggle').addEventListener('click', () => {
            document.getElementById('emoji-picker').classList.toggle('hidden');
        });
        
        // ========================================
        // TYPING INDICATOR
        // ========================================
        messageInput.addEventListener('input', () => {
            if (!database || !currentUserId) return;
            
            clearTimeout(typingTimeout);
            
            database.ref('typing/' + currentUserId).set({
                userId: currentUserId,
                username: currentUser,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            typingTimeout = setTimeout(() => {
                database.ref('typing/' + currentUserId).remove();
            }, 2000);
        });
        
        // Initialize
        initEmojiPicker();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b3f446e811490a4',t:'MTc2NjczODM2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
